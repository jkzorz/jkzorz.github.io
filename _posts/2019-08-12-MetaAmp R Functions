---
layout: post
title: "R Functions for automated data formatting and analysis using MetaAmp output"
date: 2019-08-12
---

**[MetaAmp](http://ebg.ucalgary.ca/metaamp/)** is an easy on-line pipeline used to analyze phylogenetic marker gene datasets (i.e. 16S/18S rRNA). Below are three R functions that allow the user to perform basic data manipulation and cleaning using the OTU table output from MetaAmp.  

**[Read more about MetaAmp here](https://www.frontiersin.org/articles/10.3389/fmicb.2017.01461/full)**


To use these functions you first need to make sure that the R packages *dplyr* and *stringr* are installed and loaded: 

```
install.packages("dplyr")
install.packages("stringr")
library(dplyr)
library(stringr)
```

Next, upload your OTU table from the MetaAmp output results folder.  This file should be located within the **"OTU_and_taxonomy"** folder in your MetaAmp results file. The OTU table will be called the name of your MetaAmp run followed by the suffix **".OTU-table.taxonomy"**

```
df = read.table("METAMP_RUN.OTU-table.taxonomy", header = TRUE)
```

This is a text format that looks like this when opened in excel: 

*image of OTU table**

Below is the code for the three functions. Briefly, each function does the following:  
1. **rrna_summary**: works like a pivot table in excel, and summarizes OTUs at the user defined taxonomic level 
2. **rrna_pc**: prepares data for further analysis in R:
   - Renames OTUs with the OTUID and the highest taxonomic level that could be assigned to the OTU
   - Orders OTUs based on abundance
   - Only keeps OTUs that reach a certain user-defined abundance in at least one sample (optional)
3. **rrna_taxa**: filters OTU table for a certain taxa, given a taxonomic level (i.e. Phylum) and corresponding taxa name (i.e. Cyanobacteria)





